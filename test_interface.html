<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF API Test Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .endpoint-card {
            margin-bottom: 1rem;
        }
        .response-area {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.25rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .auth-section {
            background-color: #e9ecef;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.25rem;
        }
        .document-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .document-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .bg-purple {
            background: linear-gradient(45deg, #6f42c1, #e83e8c) !important;
        }
        .interactive-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .interactive-card:hover {
            border-color: #007bff;
            box-shadow: 0 4px 15px rgba(0,123,255,0.2);
        }
        .btn-interactive {
            transition: all 0.2s ease;
        }
        .btn-interactive:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .document-preview {
            width: 100%;
            height: 200px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .document-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .document-info {
            padding: 10px;
        }
        .document-title {
            font-size: 0.9rem;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .document-date {
            font-size: 0.8rem;
            color: #666;
            margin: 5px 0;
        }
        .document-actions {
            display: flex;
            gap: 5px;
            padding: 10px;
            border-top: 1px solid #eee;
        }
        .document-actions button {
            flex: 1;
            font-size: 0.8rem;
            padding: 5px;
        }
        .loading-preview {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">PDF API Test Interface</h1>
        
        <!-- Authentication Section -->
        <div class="auth-section">
            <h3>Authentication</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">Email/Password Sign In</h5>
                            <form id="loginForm">
                                <div class="mb-3">
                                    <label for="loginEmail" class="form-label">Email address</label>
                                    <input type="email" class="form-control" id="loginEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label for="loginPassword" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="loginPassword" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Sign In</button>
                            </form>
                            <hr>
                            <h6>Or register a new account</h6>
                            <form id="registerForm">
                                <div class="mb-3">
                                    <label for="registerEmail" class="form-label">Email address</label>
                                    <input type="email" class="form-control" id="registerEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerPassword" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="registerPassword" required>
                                </div>
                                <button type="submit" class="btn btn-secondary">Register</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Google Sign In</h5>
                            <button id="googleSignInBtn" class="btn btn-primary">Sign in with Google</button>
                            <div class="response-area mt-3" id="authResponse"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Document Operations Section -->
        <h3 class="mt-4">Document Operations</h3>
        <div class="row">
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Upload PDF</h5>
                        <form id="uploadForm">
                            <div class="mb-3">
                                <input type="file" class="form-control" id="pdfFile" accept=".pdf" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Upload</button>
                        </form>
                        <div class="response-area mt-3" id="uploadResponse"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Your Documents</h5>
                        <button class="btn btn-primary" onclick="listDocuments()">Refresh List</button>
                        <div class="response-area mt-3" id="listResponse"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Document Management Section -->
        <div class="row mt-3">
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Document Details</h5>
                        <form id="documentDetailsForm">
                            <div class="mb-3">
                                <label for="documentId" class="form-label">Document ID</label>
                                <input type="text" class="form-control" id="documentId" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Get Details</button>
                        </form>
                        <div class="response-area mt-3" id="documentDetailsResponse"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Delete Document</h5>
                        <form id="deleteDocumentForm">
                            <div class="mb-3">
                                <label for="deleteDocumentId" class="form-label">Document ID</label>
                                <input type="text" class="form-control" id="deleteDocumentId" required>
                            </div>
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                        <div class="response-area mt-3" id="deleteDocumentResponse"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Conversion Section -->
        <h3 class="mt-4">File Conversion</h3>
        <div class="row">
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Image to PDF</h5>
                        <form id="imageToPdfForm">
                            <div class="mb-3">
                                <label for="imageFiles" class="form-label">Select Images</label>
                                <input type="file" class="form-control" id="imageFiles" accept="image/*" multiple required>
                            </div>
                            <button type="submit" class="btn btn-primary">Convert to PDF</button>
                        </form>
                        <div class="response-area mt-3" id="imageToPdfResponse"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Office to PDF</h5>
                        <ul class="nav nav-tabs" id="officeTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="word-tab" data-bs-toggle="tab" data-bs-target="#word" type="button" role="tab">Word</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="excel-tab" data-bs-toggle="tab" data-bs-target="#excel" type="button" role="tab">Excel</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="ppt-tab" data-bs-toggle="tab" data-bs-target="#ppt" type="button" role="tab">PowerPoint</button>
                            </li>
                        </ul>
                        <div class="tab-content mt-3" id="officeTabContent">
                            <div class="tab-pane fade show active" id="word" role="tabpanel">
                                <form id="wordToPdfForm">
                                    <div class="mb-3">
                                        <label for="wordFile" class="form-label">Select Word Document</label>
                                        <input type="file" class="form-control" id="wordFile" accept=".docx" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Convert to PDF</button>
                                </form>
                                <div class="response-area mt-3" id="wordToPdfResponse"></div>
                            </div>
                            <div class="tab-pane fade" id="excel" role="tabpanel">
                                <form id="excelToPdfForm">
                                    <div class="mb-3">
                                        <label for="excelFile" class="form-label">Select Excel Document</label>
                                        <input type="file" class="form-control" id="excelFile" accept=".xlsx" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Convert to PDF</button>
                                </form>
                                <div class="response-area mt-3" id="excelToPdfResponse"></div>
                            </div>
                            <div class="tab-pane fade" id="ppt" role="tabpanel">
                                <form id="pptToPdfForm">
                                    <div class="mb-3">
                                        <label for="pptFile" class="form-label">Select PowerPoint Document</label>
                                        <input type="file" class="form-control" id="pptFile" accept=".pptx" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Convert to PDF</button>
                                </form>
                                <div class="response-area mt-3" id="pptToPdfResponse"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mt-3">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">PDF to Word (DOCX)</h5>
                        <form id="pdfToWordForm">
                            <div class="mb-3">
                                <label for="pdfToWordDocumentId" class="form-label">Document ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="pdfToWordDocumentId" required>
                                    <button type="button" class="btn btn-outline-secondary" onclick="populateDocumentId('pdfToWordDocumentId')">Get ID</button>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Convert to DOCX</button>
                        </form>
                        <div class="response-area mt-3" id="pdfToWordResponse"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PDF Operations Section -->
        <h3 class="mt-4">PDF Operations</h3>
        <div class="row">
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Merge Documents</h5>
                        <form id="mergeForm">
                            <div class="mb-3">
                                <label for="mergeDocumentIds" class="form-label">Document IDs (comma-separated)</label>
                                <input type="text" class="form-control" id="mergeDocumentIds" placeholder="id1,id2,id3" required>
                            </div>
                            <div class="mb-3">
                                <label for="mergeOutputFilename" class="form-label">Output Filename</label>
                                <input type="text" class="form-control" id="mergeOutputFilename" value="merged.pdf">
                            </div>
                            <button type="submit" class="btn btn-primary">Merge Documents</button>
                        </form>
                        <div class="response-area mt-3" id="mergeResponse"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Add Watermark</h5>
                        <form id="watermarkForm">
                            <div class="mb-3">
                                <label for="watermarkDocumentId" class="form-label">Document ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="watermarkDocumentId" required>
                                    <button type="button" class="btn btn-outline-secondary" onclick="populateDocumentId('watermarkDocumentId')">Get ID</button>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="watermarkText" class="form-label">Watermark Text</label>
                                <input type="text" class="form-control" id="watermarkText" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Watermark</button>
                        </form>
                        <div class="response-area mt-3" id="watermarkResponse"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Compress PDF</h5>
                        <form id="compressPdfForm">
                            <div class="mb-3">
                                <label for="compressDocumentId" class="form-label">Document ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="compressDocumentId" required>
                                    <button type="button" class="btn btn-outline-secondary" onclick="populateDocumentId('compressDocumentId')">Get ID</button>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Compress PDF</button>
                        </form>
                        <div class="response-area mt-3" id="compressPdfResponse"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Convert to EPUB</h5>
                        <form id="epubForm">
                            <div class="mb-3">
                                <label for="epubDocumentId" class="form-label">Document ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="epubDocumentId" required>
                                    <button type="button" class="btn btn-outline-secondary" onclick="populateDocumentId('epubDocumentId')">Get ID</button>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Convert to EPUB</button>
                        </form>
                        <div class="response-area mt-3" id="epubResponse"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Convert to JPG</h5>
                        <form id="jpgForm">
                            <div class="mb-3">
                                <label for="jpgDocumentId" class="form-label">Document ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="jpgDocumentId" required>
                                    <button type="button" class="btn btn-outline-secondary" onclick="populateDocumentId('jpgDocumentId')">Get ID</button>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Convert to JPG</button>
                        </form>
                        <div class="response-area mt-3" id="jpgResponse"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Extract Text</h5>
                        <form id="extractTextForm">
                            <div class="mb-3">
                                <label for="extractTextDocumentId" class="form-label">Document ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="extractTextDocumentId" required>
                                    <button type="button" class="btn btn-outline-secondary" onclick="populateDocumentId('extractTextDocumentId')">Get ID</button>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Extract Text</button>
                        </form>
                        <div class="response-area mt-3" id="extractTextResponse"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive PDF Editing Section -->
        <div class="mt-4">
            <h3><i class="fas fa-edit me-2"></i>Interactive PDF Editor</h3>
            <p class="text-muted">Advanced PDF editing tools with real-time preview and interactive controls</p>
            
            <!-- Document Selection and Preview -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card interactive-card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-file-pdf me-2"></i>Select Document</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="pdfEditDocumentSelect" class="form-label">Choose PDF Document</label>
                                <select class="form-select" id="pdfEditDocumentSelect">
                                    <option value="">Select a document...</option>
                                </select>
                            </div>
                            <div class="mb-3" id="manualDocIdInput" style="display: none;">
                                <label for="manualDocumentId" class="form-label">Or Enter Document ID Manually</label>
                                <input type="text" class="form-control" id="manualDocumentId" placeholder="Enter document ID">
                                <button id="useManualDocIdBtn" class="btn btn-outline-secondary btn-sm mt-2">
                                    <i class="fas fa-check me-1"></i>Use This ID
                                </button>
                            </div>
                            <div id="documentInfo" class="alert alert-info" style="display: none;">
                                <small id="documentInfoText"></small>
                            </div>
                            <button id="refreshDocumentsBtn" class="btn btn-outline-primary btn-sm btn-interactive">
                                <i class="fas fa-sync-alt me-1"></i>Refresh List
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card interactive-card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fas fa-eye me-2"></i>Document Preview</h5>
                        </div>
                        <div class="card-body">
                            <div id="pdfPreview" class="text-center" style="min-height: 300px; background: #f8f9fa; border: 2px dashed #dee2e6; display: flex; align-items: center; justify-content: center;">
                                <div class="text-muted">
                                    <i class="fas fa-file-pdf fa-3x mb-3"></i>
                                    <p>Select a document to see preview</p>
                                </div>
                            </div>
                            <div class="mt-2">
                                <button id="downloadOriginalBtn" class="btn btn-outline-success btn-sm btn-interactive" style="display: none;">
                                    <i class="fas fa-download me-1"></i>Download Original
                                </button>
                                <button id="downloadEditedBtn" class="btn btn-outline-primary btn-sm btn-interactive" style="display: none;">
                                    <i class="fas fa-download me-1"></i>Download Edited
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <div class="row">
          <div class="col-md-6">
            <div class="card endpoint-card">
              <div class="card-body">
                <h5 class="card-title"><i class="fas fa-edit me-2"></i>Edit Text on Page</h5>
                <div class="mb-3">
                  <label for="editTextPage" class="form-label">Page Number</label>
                  <input type="number" class="form-control" id="editTextPage" placeholder="0" min="0">
                  </div>
                <div class="mb-3">
                  <label for="editTextOld" class="form-label">Text to Find</label>
                  <input type="text" class="form-control" id="editTextOld" placeholder="Enter text to replace">
                  </div>
                <div class="mb-3">
                  <label for="editTextNew" class="form-label">Replacement Text</label>
                  <input type="text" class="form-control" id="editTextNew" placeholder="Enter new text">
                  </div>
                <button id="editTextBtn" class="btn btn-warning w-100 btn-interactive">
                  <i class="fas fa-edit me-1"></i>Edit Text
                </button>
                <div class="response-area mt-2" id="editTextResponse" style="display: none;"></div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card endpoint-card">
              <div class="card-body">
                <h5 class="card-title"><i class="fas fa-plus me-2"></i>Add Text to Page</h5>
                <div class="row mb-3">
                  <div class="col-6">
                    <label for="addTextPage" class="form-label">Page Number</label>
                    <input type="number" class="form-control" id="addTextPage" placeholder="0" min="0">
                  </div>
                  <div class="col-6">
                    <label for="addTextFontSize" class="form-label">Font Size</label>
                    <input type="number" class="form-control" id="addTextFontSize" placeholder="12" min="8" max="72">
                  </div>
                  </div>
                <div class="mb-3">
                  <label for="addTextContent" class="form-label">Text to Add</label>
                  <input type="text" class="form-control" id="addTextContent" placeholder="Enter text to add">
                  </div>
                <div class="row mb-3">
                  <div class="col-6">
                    <label for="addTextX" class="form-label">X Position</label>
                    <input type="number" class="form-control" id="addTextX" placeholder="100" min="0">
                  </div>
                  <div class="col-6">
                    <label for="addTextY" class="form-label">Y Position</label>
                    <input type="number" class="form-control" id="addTextY" placeholder="100" min="0">
                  </div>
                </div>
                <button id="addTextBtn" class="btn btn-success w-100 btn-interactive">
                  <i class="fas fa-plus me-1"></i>Add Text
                </button>
                <div class="response-area mt-2" id="addTextResponse" style="display: none;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="card endpoint-card">
              <div class="card-body">
                <h5 class="card-title">Add Image to Page</h5>
                <form id="addImageForm">
                  <div class="mb-2">
                    <label for="addImageDocumentId" class="form-label">Document ID</label>
                    <input type="text" class="form-control" id="addImageDocumentId" required>
                  </div>
                  <div class="mb-2">
                    <label for="addImagePage" class="form-label">Page # (0-based)</label>
                    <input type="number" class="form-control" id="addImagePage" required>
                  </div>
                  <div class="mb-2">
                    <label for="addImageFile" class="form-label">Image File (not implemented)</label>
                    <input type="file" class="form-control" id="addImageFile" accept="image/*">
                  </div>
                  <div class="mb-2">
                    <label for="addImageX" class="form-label">X</label>
                    <input type="number" class="form-control" id="addImageX" required>
                  </div>
                  <div class="mb-2">
                    <label for="addImageY" class="form-label">Y</label>
                    <input type="number" class="form-control" id="addImageY" required>
                  </div>
                  <div class="mb-2">
                    <label for="addImageW" class="form-label">Width (optional)</label>
                    <input type="number" class="form-control" id="addImageW">
                  </div>
                  <div class="mb-2">
                    <label for="addImageH" class="form-label">Height (optional)</label>
                    <input type="number" class="form-control" id="addImageH">
                  </div>
                  <button type="submit" class="btn btn-primary">Add Image</button>
                </form>
                <div class="response-area mt-2" id="addImageResponse"></div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card endpoint-card">
              <div class="card-body">
                <h5 class="card-title"><i class="fas fa-trash me-2"></i>Remove Images from Page</h5>
                <div class="mb-3">
                  <label for="removeImagesPage" class="form-label">Page Number</label>
                  <input type="number" class="form-control" id="removeImagesPage" placeholder="0" min="0">
                  </div>
                <button id="removeImagesBtn" class="btn btn-danger w-100 btn-interactive">
                  <i class="fas fa-trash me-1"></i>Remove Images
                </button>
                <div class="response-area mt-2" id="removeImagesResponse" style="display: none;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="card endpoint-card">
              <div class="card-body">
                <h5 class="card-title"><i class="fas fa-highlighter me-2"></i>Annotate Page</h5>
                <div class="mb-3">
                  <label for="annotatePage" class="form-label">Page Number</label>
                  <input type="number" class="form-control" id="annotatePage" placeholder="0" min="0">
                  </div>
                <div class="mb-3">
                  <label for="annotateType" class="form-label">Annotation Type</label>
                    <select class="form-select" id="annotateType">
                      <option value="highlight">Highlight</option>
                      <option value="comment">Comment</option>
                      <option value="draw">Draw</option>
                    </select>
                  </div>
                <div class="mb-3">
                  <label for="annotateData" class="form-label">Annotation Data (JSON)</label>
                  <textarea class="form-control" id="annotateData" rows="3" placeholder='{"rects": [[100, 100, 200, 120]]}'></textarea>
                  <small class="text-muted">For highlight: {"rects": [[100, 100, 200, 120]]}<br>
                  For comment: {"text": "Comment", "position": [100, 100]}<br>
                  For draw: {"points": [[100, 100], [200, 200]]}</small>
                  </div>
                <button id="annotateBtn" class="btn btn-info w-100 btn-interactive">
                  <i class="fas fa-highlighter me-1"></i>Add Annotation
                </button>
                <div class="response-area mt-2" id="annotateResponse" style="display: none;"></div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card endpoint-card">
              <div class="card-body">
                <h5 class="card-title"><i class="fas fa-sort me-2"></i>Reorder Pages</h5>
                <div class="mb-3">
                  <label for="reorderPagesOrder" class="form-label">New Page Order (comma-separated)</label>
                  <input type="text" class="form-control" id="reorderPagesOrder" placeholder="2,0,1" pattern="[0-9,\s]+">
                  <small class="text-muted">Enter page indices in desired order (0-based). Example: 2,0,1 to put page 3 first, then page 1, then page 2.</small>
                  </div>
                <button id="reorderPagesBtn" class="btn btn-secondary w-100 btn-interactive">
                  <i class="fas fa-sort me-1"></i>Reorder Pages
                </button>
                <div class="response-area mt-2" id="reorderPagesResponse" style="display: none;"></div>
                
                <!-- Quick Actions -->
                <div class="mt-4">
                  <h6><i class="fas fa-bolt me-1"></i>Quick Actions</h6>
                  <div class="d-grid gap-2">
                    <button id="extractTextBtn" class="btn btn-outline-primary btn-sm btn-interactive">
                      <i class="fas fa-file-alt me-1"></i>Extract All Text
                    </button>
                    <button id="getPageCountBtn" class="btn btn-outline-secondary btn-sm btn-interactive">
                      <i class="fas fa-list-ol me-1"></i>Get Page Count
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

            <!-- Results and Status -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-dark text-white">
                            <h5 class="mb-0"><i class="fas fa-terminal me-2"></i>Operation Results</h5>
                        </div>
                        <div class="card-body">
                            <div id="pdfEditResults" class="response-area" style="min-height: 200px;">
                                <div class="text-muted text-center">
                                    <i class="fas fa-info-circle fa-2x mb-3"></i>
                                    <p>Results from PDF editing operations will appear here</p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button id="clearResultsBtn" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-trash me-1"></i>Clear Results
                                </button>
                                <button id="downloadAllBtn" class="btn btn-outline-primary btn-sm" style="display: none;">
                                    <i class="fas fa-download me-1"></i>Download All Edited Files
                                </button>
                            </div>
                        </div>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Features Section -->
        <h3 class="mt-4">AI Features</h3>
        <div class="row">
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Chat with PDF</h5>
                        <form id="chatForm">
                            <div class="mb-3">
                                <label for="chatDocumentId" class="form-label">Document ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="chatDocumentId" required>
                                    <button type="button" class="btn btn-outline-secondary" onclick="populateDocumentId('chatDocumentId')">Get ID</button>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="chatMessage" class="form-label">Message</label>
                                <textarea class="form-control" id="chatMessage" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Send Message</button>
                        </form>
                        <div class="response-area mt-3" id="chatResponse"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card endpoint-card">
                    <div class="card-body">
                        <h5 class="card-title">Grammar Check</h5>
                        <form id="grammarForm">
                            <div class="mb-3">
                                <label for="grammarText" class="form-label">Text to Check</label>
                                <textarea class="form-control" id="grammarText" rows="4" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Check Grammar</button>
                        </form>
                        <div class="response-area mt-3" id="grammarResponse"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://redanpdf-kz99.onrender.com/api/v1';
        let token = localStorage.getItem('token');

        // Firebase configuration
        const firebaseConfig = {
            // Add your Firebase config here
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Google Sign In
        document.getElementById('googleSignInBtn').addEventListener('click', async () => {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await firebase.auth().signInWithPopup(provider);
                
                // Get the ID token
                const idToken = await result.user.getIdToken();
                
                // Store the token
                localStorage.setItem('token', idToken);
                
                // Update UI
                document.getElementById('authResponse').textContent = 'Successfully signed in with Google!';
                document.getElementById('googleSignInBtn').textContent = 'Signed in as ' + result.user.email;
                document.getElementById('googleSignInBtn').disabled = true;
                
                // Enable document operations
                enableDocumentOperations();
            } catch (error) {
                document.getElementById('authResponse').textContent = 'Error: ' + error.message;
            }
        });

        // Check if user is already signed in
        firebase.auth().onAuthStateChanged(async (user) => {
            if (user) {
                // Get the ID token
                const idToken = await user.getIdToken();
                localStorage.setItem('token', idToken);
                
                // Update UI
                document.getElementById('googleSignInBtn').textContent = 'Signed in as ' + user.email;
                document.getElementById('googleSignInBtn').disabled = true;
                
                // Enable document operations
                enableDocumentOperations();
            }
        });

        function enableDocumentOperations() {
            // Enable all document operation buttons and forms
            document.querySelectorAll('button[type="submit"]').forEach(btn => {
                btn.disabled = false;
            });
        }

        // Function to populate document ID fields with actual document IDs
        async function populateDocumentId(fieldId) {
            try {
                const response = await callApi('/documents/list');
                if (response && response.length > 0) {
                    const documentId = response[0].id; // Get the first document ID
                    document.getElementById(fieldId).value = documentId;
                    console.log(`Populated ${fieldId} with document ID: ${documentId}`);
                } else {
                    alert('No documents found. Please upload a document first.');
                }
            } catch (error) {
                alert('Error getting document ID: ' + error.message);
            }
        }

        // Helper function to make API calls
        async function callApi(endpoint, method = 'GET', data = null, isFormData = false) {
            console.log(`callApi called with: ${method} ${endpoint}`); // Debug log
            const token = localStorage.getItem('token');
            if (!token) {
                throw new Error('Not authenticated. Please sign in with Google.');
            }

            const headers = {
                'Authorization': `Bearer ${token}`
            };

            const options = {
                method,
                headers
            };

            // Only add body for non-GET requests
            if (data && method !== 'GET') {
                if (!isFormData) {
                    headers['Content-Type'] = 'application/json';
                }
                options.body = isFormData ? data : JSON.stringify(data);
            }

            console.log(`Making request to: ${API_BASE_URL}${endpoint}`); // Debug log
            const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
            console.log(`Response status: ${response.status}`); // Debug log
            
            if (response.status === 401) {
                // Token expired or invalid
                localStorage.removeItem('token');
                document.getElementById('googleSignInBtn').textContent = 'Sign in with Google';
                document.getElementById('googleSignInBtn').disabled = false;
                throw new Error('Session expired. Please sign in again.');
            }

            if (!response.ok) {
                throw new Error(`API call failed: ${response.statusText}`);
            }

            return response.json();
        }

        // Document operations handlers
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('file', document.getElementById('pdfFile').files[0]);
            
            try {
                const response = await callApi('/documents/upload', 'POST', formData, true);
                document.getElementById('uploadResponse').textContent = JSON.stringify(response, null, 2);
            } catch (error) {
                document.getElementById('uploadResponse').textContent = 'Error: ' + error.message;
            }
        });

        async function listDocuments() {
            try {
                const response = await callApi('/documents/list');
                const responseDiv = document.getElementById('listResponse');
                
                // Create a grid layout for documents
                let html = '<div class="document-grid">';
                
                response.forEach(doc => {
                    html += `
                        <div class="document-card">
                            <div class="document-preview">
                                <div class="loading-preview">Loading preview...</div>
                                <img src="/api/v1/documents/${doc.id}/preview" 
                                     alt="${doc.filename}"
                                     onload="this.previousElementSibling.style.display='none'"
                                     onerror="this.style.display='none'; this.previousElementSibling.textContent='Preview not available'">
                            </div>
                            <div class="document-info">
                                <h6 class="document-title" title="${doc.filename}">${doc.filename}</h6>
                                <div class="document-date">${new Date(doc.created_at).toLocaleString()}</div>
                            </div>
                            <div class="document-actions">
                                <button class="btn btn-sm btn-primary" onclick="downloadDocument('${doc.id}', '${doc.filename}')">
                                    Download
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteDocument('${doc.id}')">
                                    Delete
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                responseDiv.innerHTML = html;
            } catch (error) {
                document.getElementById('listResponse').textContent = 'Error: ' + error.message;
            }
        }

        async function downloadDocument(documentId, filename) {
            try {
                const response = await fetch(`${API_BASE_URL}/documents/${documentId}/download`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('jwtToken')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Download failed');
                }
                
                // Create a blob from the response
                const blob = await response.blob();
                
                // Create a download link
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (error) {
                alert('Error downloading document: ' + error.message);
            }
        }

        async function deleteDocument(documentId) {
            if (!confirm('Are you sure you want to delete this document?')) {
                return;
            }
            
            try {
                await callApi(`/documents/${documentId}`, 'DELETE');
                // Refresh the document list
                listDocuments();
            } catch (error) {
                alert('Error deleting document: ' + error.message);
            }
        }

        // Document Management
        document.getElementById('documentDetailsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await callApi(`/documents/${document.getElementById('documentId').value}`);
                document.getElementById('documentDetailsResponse').textContent = JSON.stringify(response, null, 2);
            } catch (error) {
                document.getElementById('documentDetailsResponse').textContent = 'Error: ' + error.message;
            }
        });

        document.getElementById('deleteDocumentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await callApi(`/documents/${document.getElementById('deleteDocumentId').value}`, 'DELETE');
                document.getElementById('deleteDocumentResponse').textContent = JSON.stringify(response, null, 2);
            } catch (error) {
                document.getElementById('deleteDocumentResponse').textContent = 'Error: ' + error.message;
            }
        });

        // File Conversion
        document.getElementById('imageToPdfForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const formData = new FormData();
                const files = document.getElementById('imageFiles').files;
                for (let file of files) {
                    formData.append('files', file);
                }
                const response = await callApi('/documents/image-to-pdf', 'POST', formData, true);
                document.getElementById('imageToPdfResponse').textContent = JSON.stringify(response, null, 2);
            } catch (error) {
                document.getElementById('imageToPdfResponse').textContent = 'Error: ' + error.message;
            }
        });

        document.getElementById('wordToPdfForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const formData = new FormData();
                formData.append('file', document.getElementById('wordFile').files[0]);
                const response = await callApi('/documents/convert/word-to-pdf', 'POST', formData, true);
                
                // Show success message with download link
                const successMessage = `
✅ Word file converted successfully!

📄 Document ID: ${response.id}
📁 Filename: ${response.filename}
🔗 Download URL: ${response.download_url}

The converted PDF has been added to your documents. You can download it using the link above or find it in your document list.
                `;
                document.getElementById('wordToPdfResponse').innerHTML = `<div class="alert alert-success">${successMessage.replace(/\n/g, '<br>')}</div>`;
                
                // Clear the form
                document.getElementById('wordFile').value = '';
                
                // Refresh document list to show the new file
                setTimeout(() => {
                    listDocuments();
                }, 1000);
                
            } catch (error) {
                document.getElementById('wordToPdfResponse').innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        });

        document.getElementById('excelToPdfForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const formData = new FormData();
                formData.append('file', document.getElementById('excelFile').files[0]);
                const response = await callApi('/documents/convert/excel-to-pdf', 'POST', formData, true);
                
                // Show success message with download link
                const successMessage = `
✅ Excel file converted successfully!

📄 Document ID: ${response.id}
📁 Filename: ${response.filename}
🔗 Download URL: ${response.download_url}
💬 Message: ${response.message}

The converted PDF has been added to your documents. You can download it using the link above or find it in your document list.
                `;
                document.getElementById('excelToPdfResponse').innerHTML = `<div class="alert alert-success">${successMessage.replace(/\n/g, '<br>')}</div>`;
                
                // Clear the form
                document.getElementById('excelFile').value = '';
                
                // Refresh document list to show the new file
                setTimeout(() => {
                    listDocuments();
                }, 1000);
                
            } catch (error) {
                document.getElementById('excelToPdfResponse').innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        });

        document.getElementById('pptToPdfForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const formData = new FormData();
                formData.append('file', document.getElementById('pptFile').files[0]);
                const response = await callApi('/documents/convert/ppt-to-pdf', 'POST', formData, true);
                
                // Show success message with download link
                const successMessage = `
✅ PowerPoint file converted successfully!

📄 Document ID: ${response.id}
📁 Filename: ${response.filename}
🔗 Download URL: ${response.download_url}

The converted PDF has been added to your documents. You can download it using the link above or find it in your document list.
                `;
                document.getElementById('pptToPdfResponse').innerHTML = `<div class="alert alert-success">${successMessage.replace(/\n/g, '<br>')}</div>`;
                
                // Clear the form
                document.getElementById('pptFile').value = '';
                
                // Refresh document list to show the new file
                setTimeout(() => {
                    listDocuments();
                }, 1000);
                
            } catch (error) {
                document.getElementById('pptToPdfResponse').innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        });

        // PDF Operations
        document.getElementById('mergeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const formData = new FormData();
                const documentIds = document.getElementById('mergeDocumentIds').value.split(',').map(id => id.trim());
                documentIds.forEach(id => formData.append('document_ids', id));
                formData.append('output_filename', document.getElementById('mergeOutputFilename').value);
                const response = await callApi('/documents/merge', 'POST', formData, true);
                
                // Show success message with download link
                const successMessage = `
✅ Documents merged successfully!

📄 Document ID: ${response.id}
📁 Filename: ${response.filename}
🔗 Download URL: ${response.download_url}
💬 Message: ${response.message}

The merged PDF has been added to your documents. You can download it using the link above or find it in your document list.
                `;
                document.getElementById('mergeResponse').innerHTML = `<div class="alert alert-success">${successMessage.replace(/\n/g, '<br>')}</div>`;
                
                // Clear the form
                document.getElementById('mergeDocumentIds').value = '';
                document.getElementById('mergeOutputFilename').value = '';
                
                // Refresh document list to show the new file
                setTimeout(() => {
                    listDocuments();
                }, 1000);
            } catch (error) {
                document.getElementById('mergeResponse').innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        });

        document.getElementById('watermarkForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const formData = new FormData();
                formData.append('watermark_text', document.getElementById('watermarkText').value);
                const response = await callApi(`/documents/${document.getElementById('watermarkDocumentId').value}/watermark`, 'POST', formData, true);
                
                // Show success message with download link
                const successMessage = `
✅ Watermark added successfully!

📄 Document ID: ${response.id}
📁 Filename: ${response.filename}
🔗 Download URL: ${response.download_url}
💬 Message: ${response.message}

The watermarked PDF has been added to your documents. You can download it using the link above or find it in your document list.
                `;
                document.getElementById('watermarkResponse').innerHTML = `<div class="alert alert-success">${successMessage.replace(/\n/g, '<br>')}</div>`;
                
                // Clear the form
                document.getElementById('watermarkText').value = '';
                document.getElementById('watermarkDocumentId').value = '';
                
                // Refresh document list to show the new file
                setTimeout(() => {
                    listDocuments();
                }, 1000);
            } catch (error) {
                document.getElementById('watermarkResponse').innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        });

        document.getElementById('compressPdfForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            console.log('Compress button clicked!'); // Debug log
            try {
                const documentId = document.getElementById('compressDocumentId').value;
                console.log('Attempting to compress document:', documentId); // Debug log
                const response = await callApi(`/documents/${documentId}/compress`, 'POST');
                console.log('Compress response:', response); // Debug log
                // Show success message with download link
                const successMessage = `
✅ PDF compressed successfully!

📄 Document ID: ${response.id}
📁 Filename: ${response.filename}
🔗 Download URL: ${response.download_url}
💬 Message: ${response.message}

The compressed PDF has been added to your documents. You can download it using the link above or find it in your document list.
                `;
                document.getElementById('compressPdfResponse').innerHTML = `<div class="alert alert-success">${successMessage.replace(/\n/g, '<br>')}</div>`;
                
                // Clear the form
                document.getElementById('compressDocumentId').value = '';
                
                // Refresh document list to show the new file
                setTimeout(() => {
                    listDocuments();
                }, 1000);
            } catch (error) {
                console.error('Compress error:', error); // Debug log
                document.getElementById('compressPdfResponse').innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        });

        document.getElementById('epubForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await callApi(`/documents/${document.getElementById('epubDocumentId').value}/to-epub`, 'POST');
                document.getElementById('epubResponse').textContent = JSON.stringify(response, null, 2);
            } catch (error) {
                document.getElementById('epubResponse').textContent = 'Error: ' + error.message;
            }
        });

        document.getElementById('jpgForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await callApi(`/documents/${document.getElementById('jpgDocumentId').value}/to-jpg`, 'POST');
                document.getElementById('jpgResponse').textContent = JSON.stringify(response, null, 2);
            } catch (error) {
                document.getElementById('jpgResponse').textContent = 'Error: ' + error.message;
            }
        });

        // PDF to Word (DOCX)
        document.getElementById('pdfToWordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const docId = document.getElementById('pdfToWordDocumentId').value.trim();
                if (!docId) throw new Error('Please provide a document ID');
                const response = await callApi(`/pdfs/${docId}/to_word`, 'POST');
                const html = `
✅ DOCX created successfully!<br>
📄 New Document ID: ${response.new_document_id}<br>
🔗 <a href="${response.download_url}" target="_blank">Download DOCX</a>
                `;
                document.getElementById('pdfToWordResponse').innerHTML = `<div class="alert alert-success">${html}</div>`;
            } catch (error) {
                document.getElementById('pdfToWordResponse').innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        });

        document.getElementById('extractTextForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await callApi(`/documents/${document.getElementById('extractTextDocumentId').value}/extract-text`, 'GET');
                document.getElementById('extractTextResponse').textContent = JSON.stringify(response, null, 2);
            } catch (error) {
                document.getElementById('extractTextResponse').textContent = 'Error: ' + error.message;
            }
        });

        // Grammar Check
        document.getElementById('grammarForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await callApi('/ai/grammar-check', 'POST', {
                    text: document.getElementById('grammarText').value
                });
                document.getElementById('grammarResponse').textContent = JSON.stringify(response, null, 2);
            } catch (error) {
                document.getElementById('grammarResponse').textContent = 'Error: ' + error.message;
            }
        });

        // AI features handlers
        document.getElementById('chatForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await fetch(`${API_BASE_URL}/ai/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        query: document.getElementById('chatMessage').value,
                        document_id: document.getElementById('chatDocumentId').value
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Chat request failed');
                }

                const data = await response.json();
                document.getElementById('chatResponse').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                console.error('Chat error:', error);
                document.getElementById('chatResponse').textContent = 'Error: ' + error.message;
            }
        });

        // Email/Password Login
        if (document.getElementById('loginForm')) {
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                try {
                    const formData = new URLSearchParams();
                    formData.append('username', email);
                    formData.append('password', password);
                    const response = await fetch(`${API_BASE_URL}/auth/token`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData
                    });
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || 'Login failed');
                    }
                    const data = await response.json();
                    localStorage.setItem('token', data.access_token);
                    document.getElementById('authResponse').textContent = 'Signed in successfully!';
                    enableDocumentOperations();
                } catch (err) {
                    document.getElementById('authResponse').textContent = err.message;
                }
            });
        }
        // Registration
        if (document.getElementById('registerForm')) {
            document.getElementById('registerForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                try {
                    const response = await fetch(`${API_BASE_URL}/auth/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || 'Registration failed');
                    }
                    document.getElementById('authResponse').textContent = 'Registration successful! You can now sign in.';
                } catch (err) {
                    document.getElementById('authResponse').textContent = err.message;
                }
            });
        }

        // Interactive PDF Editor JavaScript
        let currentDocumentId = null;
        let editedDocuments = [];

        // Helper functions
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('pdfEditResults');
            const timestamp = new Date().toLocaleTimeString();
            const alertClass = type === 'error' ? 'alert-danger' : type === 'success' ? 'alert-success' : 'alert-info';
            
            resultsDiv.innerHTML = `
                <div class="alert ${alertClass} mb-2">
                    <small class="text-muted">[${timestamp}]</small> ${message}
                </div>
                ${resultsDiv.innerHTML}
            `;
        }

        function loadDocumentsList() {
            // Check if user is authenticated
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                showResult('⚠️ Please login first to load documents', 'error');
                return;
            }

            fetch(`${API_BASE_URL}/documents/list`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(documents => {
                const select = document.getElementById('pdfEditDocumentSelect');
                select.innerHTML = '<option value="">Select a document...</option>';
                if (documents.length === 0) {
                    select.innerHTML += '<option value="" disabled>No documents found</option>';
                    showResult('ℹ️ No documents found. Upload a document first.', 'info');
                } else {
                    documents.forEach(doc => {
                        const option = document.createElement('option');
                        option.value = doc.id;
                        option.textContent = `${doc.filename} (${doc.file_size} bytes)`;
                        select.appendChild(option);
                    });
                    showResult(`✅ Loaded ${documents.length} document(s)`, 'success');
                }
            })
            .catch(error => {
                showResult(`❌ Error loading documents: ${error.message}`, 'error');
                // Add manual entry option
                const select = document.getElementById('pdfEditDocumentSelect');
                select.innerHTML = '<option value="">Select a document...</option>';
                select.innerHTML += '<option value="manual">Enter Document ID Manually</option>';
            });
        }

        async function loadDocumentPreview(documentId) {
            const previewDiv = document.getElementById('pdfPreview');
            previewDiv.innerHTML = `
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Loading preview...</p>
                </div>
            `;
            
            try {
                // Load preview image with authentication
                const token = localStorage.getItem('jwtToken');
                const response = await fetch(`${API_BASE_URL}/documents/${documentId}/preview`, {
                    headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(blob);
                    img.className = 'img-fluid';
                    img.style.maxHeight = '300px';
                    
                    previewDiv.innerHTML = '';
                    previewDiv.appendChild(img);
                    showResult(`✅ Preview loaded for document: ${documentId}`, 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                previewDiv.innerHTML = `
                    <div class="text-muted">
                        <i class="fas fa-file-pdf fa-3x mb-3"></i>
                        <p>Preview not available</p>
                        <small>Document ID: ${documentId}</small>
                        <br><small class="text-danger">Error: ${error.message}</small>
                    </div>
                `;
                showResult(`⚠️ Preview not available for document: ${documentId}: ${error.message}`, 'error');
            }
        }

        function clearDocumentPreview() {
            document.getElementById('pdfPreview').innerHTML = `
                <div class="text-muted">
                    <i class="fas fa-file-pdf fa-3x mb-3"></i>
                    <p>Select a document to see preview</p>
                </div>
            `;
        }

        function updateDocumentInfo(documentId) {
            // This would fetch document details and update the info panel
            document.getElementById('documentInfo').style.display = 'block';
            document.getElementById('documentInfoText').textContent = `Document ID: ${documentId}`;
        }

        // Document selection handler
        document.getElementById('pdfEditDocumentSelect').addEventListener('change', function() {
            const selectedValue = this.value;
            if (selectedValue === 'manual') {
                document.getElementById('manualDocIdInput').style.display = 'block';
                currentDocumentId = null;
                clearDocumentPreview();
                document.getElementById('downloadOriginalBtn').style.display = 'none';
            } else if (selectedValue) {
                document.getElementById('manualDocIdInput').style.display = 'none';
                currentDocumentId = selectedValue;
                loadDocumentPreview(currentDocumentId);
                updateDocumentInfo(currentDocumentId);
                document.getElementById('downloadOriginalBtn').style.display = 'inline-block';
            } else {
                document.getElementById('manualDocIdInput').style.display = 'none';
                currentDocumentId = null;
                clearDocumentPreview();
                document.getElementById('downloadOriginalBtn').style.display = 'none';
            }
        });

        // Manual document ID handler
        document.getElementById('useManualDocIdBtn').addEventListener('click', function() {
            const manualId = document.getElementById('manualDocumentId').value.trim();
            if (manualId) {
                currentDocumentId = manualId;
                loadDocumentPreview(currentDocumentId);
                updateDocumentInfo(currentDocumentId);
                document.getElementById('downloadOriginalBtn').style.display = 'inline-block';
                showResult(`✅ Using document ID: ${manualId}`, 'success');
            } else {
                showResult('❌ Please enter a document ID', 'error');
            }
        });

        // Refresh documents list
        document.getElementById('refreshDocumentsBtn').addEventListener('click', function() {
            loadDocumentsList();
        });

        // Edit text handler
        document.getElementById('editTextBtn').addEventListener('click', async function() {
            if (!currentDocumentId) {
                showResult('Please select a document first', 'error');
                return;
            }
            
          const page = document.getElementById('editTextPage').value;
          const oldText = document.getElementById('editTextOld').value;
          const newText = document.getElementById('editTextNew').value;
            
            if (!page || !oldText || !newText) {
                showResult('Please fill in all fields', 'error');
                return;
            }

            try {
                showResult('Editing text...', 'info');
                const formData = new FormData();
                formData.append('page_number', page);
                formData.append('old_text', oldText);
                formData.append('new_text', newText);
                
                const token = localStorage.getItem('jwtToken');
                const resp = await fetch(`${API_BASE_URL}/documents/${currentDocumentId}/edit-text`, {
                    method: 'POST',
                    headers: token ? { 'Authorization': `Bearer ${token}` } : {},
                    body: formData
                });
            const result = await resp.json();
                
                if (resp.ok) {
                    showResult(`✅ Text edited successfully! New document ID: ${result.new_document_id}`, 'success');
                    editedDocuments.push(result);
                    document.getElementById('downloadEditedBtn').style.display = 'inline-block';
                } else {
                    showResult(`❌ Error: ${result.detail || 'Unknown error'}`, 'error');
                }
            } catch (e) {
                showResult(`❌ Error: ${e.message}`, 'error');
            }
        });
        // Add text handler
        document.getElementById('addTextBtn').addEventListener('click', async function() {
            if (!currentDocumentId) {
                showResult('Please select a document first', 'error');
                return;
            }
            
          const page = document.getElementById('addTextPage').value;
          const text = document.getElementById('addTextContent').value;
          const x = document.getElementById('addTextX').value;
          const y = document.getElementById('addTextY').value;
          const fontSize = document.getElementById('addTextFontSize').value || 12;
            
            if (!page || !text || !x || !y) {
                showResult('Please fill in all required fields', 'error');
                return;
            }

            try {
                showResult('Adding text...', 'info');
                const formData = new FormData();
                formData.append('page_number', page);
                formData.append('text', text);
                formData.append('x', x);
                formData.append('y', y);
                formData.append('font_size', fontSize);
                
                const token = localStorage.getItem('jwtToken');
                const resp = await fetch(`${API_BASE_URL}/documents/${currentDocumentId}/add-text`, {
                    method: 'POST',
                    headers: token ? { 'Authorization': `Bearer ${token}` } : {},
                    body: formData
                });
            const result = await resp.json();
                
                if (resp.ok) {
                    showResult(`✅ Text added successfully! New document ID: ${result.new_document_id}`, 'success');
                    editedDocuments.push(result);
                    document.getElementById('downloadEditedBtn').style.display = 'inline-block';
                } else {
                    showResult(`❌ Error: ${result.detail || 'Unknown error'}`, 'error');
                }
            } catch (e) {
                showResult(`❌ Error: ${e.message}`, 'error');
            }
        });
        // Image upload not implemented yet
        // Remove images handler
        document.getElementById('removeImagesBtn').addEventListener('click', async function() {
            if (!currentDocumentId) {
                showResult('Please select a document first', 'error');
                return;
            }
            
          const page = document.getElementById('removeImagesPage').value;
            if (!page) {
                showResult('Please enter a page number', 'error');
                return;
            }

            try {
                showResult('Removing images...', 'info');
                const formData = new FormData();
                formData.append('page_number', page);
                
                const token = localStorage.getItem('jwtToken');
                const resp = await fetch(`${API_BASE_URL}/documents/${currentDocumentId}/remove-images`, {
                    method: 'POST',
                    headers: token ? { 'Authorization': `Bearer ${token}` } : {},
                    body: formData
                });
            const result = await resp.json();
                
                if (resp.ok) {
                    showResult(`✅ Images removed successfully! New document ID: ${result.new_document_id}`, 'success');
                    editedDocuments.push(result);
                    document.getElementById('downloadEditedBtn').style.display = 'inline-block';
                } else {
                    showResult(`❌ Error: ${result.detail || 'Unknown error'}`, 'error');
                }
            } catch (e) {
                showResult(`❌ Error: ${e.message}`, 'error');
            }
        });
        // Annotation handler
        document.getElementById('annotateBtn').addEventListener('click', async function() {
            if (!currentDocumentId) {
                showResult('Please select a document first', 'error');
                return;
            }
            
          const page = document.getElementById('annotatePage').value;
          const type = document.getElementById('annotateType').value;
          const data = document.getElementById('annotateData').value;
            
            if (!page || !type || !data) {
                showResult('Please fill in all fields', 'error');
                return;
            }

            try {
                showResult('Adding annotation...', 'info');
                const formData = new FormData();
                formData.append('page_number', page);
                formData.append('annotation_type', type);
                formData.append('data', data);
                
                const token = localStorage.getItem('jwtToken');
                const resp = await fetch(`${API_BASE_URL}/documents/${currentDocumentId}/annotate`, {
                    method: 'POST',
                    headers: token ? { 'Authorization': `Bearer ${token}` } : {},
                    body: formData
                });
            const result = await resp.json();
                
                if (resp.ok) {
                    showResult(`✅ Annotation added successfully! New document ID: ${result.new_document_id}`, 'success');
                    editedDocuments.push(result);
                    document.getElementById('downloadEditedBtn').style.display = 'inline-block';
                } else {
                    showResult(`❌ Error: ${result.detail || 'Unknown error'}`, 'error');
                }
            } catch (e) {
                showResult(`❌ Error: ${e.message}`, 'error');
            }
        });
        // Reorder pages handler
        document.getElementById('reorderPagesBtn').addEventListener('click', async function() {
            if (!currentDocumentId) {
                showResult('Please select a document first', 'error');
                return;
            }
            
          const order = document.getElementById('reorderPagesOrder').value;
            if (!order) {
                showResult('Please enter page order', 'error');
                return;
            }

            try {
                showResult('Reordering pages...', 'info');
                const orderArray = order.split(',').map(x => parseInt(x.trim()));
                
                const token = localStorage.getItem('jwtToken');
                const url = `${API_BASE_URL}/pdfs/${currentDocumentId}/reorder_pages`;
                
                // Debug logging
                console.log('Reorder request details:');
                console.log('URL:', url);
                console.log('Document ID:', currentDocumentId);
                console.log('Order array:', orderArray);
                console.log('Token exists:', !!token);
                
                // Send as query parameters (like other endpoints in pdf.py)
                const queryParams = orderArray.map(pageIndex => `new_order=${pageIndex}`).join('&');
                const urlWithParams = `${url}?${queryParams}`;
                
                const resp = await fetch(urlWithParams, {
                    method: 'POST',
                    headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                });
            const result = await resp.json();
                
                if (resp.ok) {
                    showResult(`✅ Pages reordered successfully! New document ID: ${result.new_document_id}`, 'success');
                    editedDocuments.push(result);
                    document.getElementById('downloadEditedBtn').style.display = 'inline-block';
                } else {
                    showResult(`❌ Error: ${result.detail || 'Unknown error'}`, 'error');
                }
            } catch (e) {
                showResult(`❌ Error: ${e.message}`, 'error');
            }
        });

        // Clear results handler
        document.getElementById('clearResultsBtn').addEventListener('click', function() {
            document.getElementById('pdfEditResults').innerHTML = `
                <div class="text-muted text-center">
                    <i class="fas fa-info-circle fa-2x mb-3"></i>
                    <p>Results from PDF editing operations will appear here</p>
                </div>
            `;
        });

        // Download handlers
        document.getElementById('downloadOriginalBtn').addEventListener('click', async function() {
            if (currentDocumentId) {
                try {
                    const token = localStorage.getItem('jwtToken');
                    const response = await fetch(`${API_BASE_URL}/documents/${currentDocumentId}/download`, {
                        headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `document_${currentDocumentId}.pdf`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        showResult('✅ Original document downloaded', 'success');
                    } else {
                        showResult(`❌ Download failed: ${response.status} ${response.statusText}`, 'error');
                    }
                } catch (error) {
                    showResult(`❌ Download error: ${error.message}`, 'error');
                }
            }
        });

        document.getElementById('downloadEditedBtn').addEventListener('click', async function() {
            if (editedDocuments.length > 0) {
                try {
                    const latestDoc = editedDocuments[editedDocuments.length - 1];
                    const token = localStorage.getItem('jwtToken');
                    const response = await fetch(`${API_BASE_URL}/documents/${latestDoc.new_document_id}/download`, {
                        headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `edited_document_${latestDoc.new_document_id}.pdf`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        showResult('✅ Edited document downloaded', 'success');
                    } else {
                        showResult(`❌ Download failed: ${response.status} ${response.statusText}`, 'error');
                    }
                } catch (error) {
                    showResult(`❌ Download error: ${error.message}`, 'error');
                }
            }
        });

        // Quick action handlers
        document.getElementById('extractTextBtn').addEventListener('click', async function() {
            if (!currentDocumentId) {
                showResult('Please select a document first', 'error');
                return;
            }

            try {
                showResult('Extracting text...', 'info');
                const token = localStorage.getItem('jwtToken');
                const response = await fetch(`${API_BASE_URL}/documents/${currentDocumentId}/extract-text`, {
                    headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                });
                const result = await response.json();
                
                if (response.ok) {
                    showResult(`✅ Text extracted successfully! Length: ${result.text?.length || 0} characters`, 'success');
                    // Show text in a modal or expandable area
                    const textPreview = result.text?.substring(0, 500) + (result.text?.length > 500 ? '...' : '');
                    showResult(`📄 Text Preview: ${textPreview}`, 'info');
                } else {
                    showResult(`❌ Error: ${result.detail || 'Unknown error'}`, 'error');
                }
            } catch (e) {
                showResult(`❌ Error: ${e.message}`, 'error');
            }
        });

        document.getElementById('getPageCountBtn').addEventListener('click', async function() {
            if (!currentDocumentId) {
                showResult('Please select a document first', 'error');
                return;
            }

            try {
                showResult('Getting page count...', 'info');
                // This would need a page count endpoint, for now just show a message
                showResult('ℹ️ Page count feature would need a dedicated endpoint', 'info');
            } catch (e) {
                showResult(`❌ Error: ${e.message}`, 'error');
            }
        });

        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is authenticated
            const token = localStorage.getItem('jwtToken');
            if (token) {
                showResult('✅ User authenticated. Loading documents...', 'success');
                loadDocumentsList();
            } else {
                showResult('⚠️ Please login first to access documents. You can also enter a document ID manually.', 'error');
                // Add manual entry option immediately
                const select = document.getElementById('pdfEditDocumentSelect');
                select.innerHTML = '<option value="">Select a document...</option>';
                select.innerHTML += '<option value="manual">Enter Document ID Manually</option>';
            }
        });
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 